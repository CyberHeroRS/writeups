## Crypto/yougetextrainformation2

>Author: hellopir2
>
>179 solves / 359 points

*Note: Below you'll find a guided solution. If interested just in the solve script, click [here](#solve-script-cryptoyougetextrainformation2)*

#### The Challenge

The challenge states:

```You get more information! More complicated = more information right.```

Provided for download are two challenge files: `main.py` and `output.txt`. When we open `main.py` we can see the following code:

```python
from Crypto.Util.number import *
from flag import flag

p = getPrime(512)
q = getPrime(512)
n = p*q
e = 0x10001
extra_information = (n**2)*(p**3 + 5*(p+1)**2) + 5*n*q + q**2
ptxt = bytes_to_long(flag)
c = pow(ptxt, e, n)

with open('output.txt', 'w') as f:
    f.write(f"n: {n}\nc: {c}\ne: {e}\nextra_information: {extra_information}")
```

Like in the first part of this challenge we get a standard RSA implementation and some extra information that will help us get teh flag. And if we take a look into the output file we get exactly what's expected:

```python
n: 95593382112797270045497836514999308524326160650345266525670495575191979116591752182138270308274446464071024826510473429700676303637674960212123982700153540490805215151070356646141514736282385755143090035980011032465519861526291865888128545478530962058792257703950616556136479933021373472378679162332202365371
c: 92084942302809419329882275131365664619817865820237979575321652348851871468885232665120732298048355621943772250718055278615366362227084559410831820721620242260588398786014654743749734106956509345330468686120026908164376320923131751798117799981744551407234489862207435686504148347452579942637697333568788391594
e: 65537
extra_information: 18247071175606431398122118602371784578875472790915317892207044424588309397797319375039984309368393267673885302107217184699052743790470091033147110959310433418937324145720036262540098007724458652548486534453030546582214242131458903058169536052488501597969216020092796160475487905223265691093061136660574497410399108890645909789835984721231354187679269066357591297035974333220513134895660609801438138623213711900681512310067292949714127564635579383633589101296120704659647911638787823818973909534106275908594589830353183557722172234952579827423906720754070119865452363350814918812923981729393142874903734028229195885438296963982680724071663211427931391032589901737528717167662646147224323491202696402122261699504048973334902281462240308032014697804531871922566779026958815207465755155123070196922127199447785648102152027431894178737946151518726929361221425189695069653652163012000609320105988830299015364692678902927254273154427301473090465612473379114039284029813071586214536353994345527805408387636097772645156970939979500155578289301143563369142329343932852167241705090287661795
```


#### Derieving p and q

This time the information we got is much more complex and needs to be used a bit differently. But before writing a solution script the data we got needs to be formatted a bit:

$$extra_information = n^{2} * (p^{3} + 5 * (p + 1)^{2}) + 5 * n * q + q^{2}$$

$$n = p * q$$

$$(p + 1)^{2} = p^{2} + 2 * p + 1$$

We can combine these equations like:

$$extra_information = p^{2} * q^{2} * (p^{3} + 5 * (p + 1)^{2}) + 5 * p * q * q + q^{2}$$

$$extra_information = (p^{5}) * (q^{2}) + 5 * (p^{4}) * (q^{2}) + 10 * (p^{3}) * (q^{2}) + 5 * (p^{2}) * (q^{2}) + 5 * (q^{2}) * p + (q^{2})$$

With the extra_information simplified we can now use [Z3](https://github.com/Z3Prover/z3) to write the solution script.

### Solve script (crypto/yougetextrainformation2)

To get the solution we just take the values from `output.txt` file and implement them into a Z3 solver:

```python
#!/bin/python
from Crypto.Util.number import *
import z3

n= 95593382112797270045497836514999308524326160650345266525670495575191979116591752182138270308274446464071024826510473429700676303637674960212123982700153540490805215151070356646141514736282385755143090035980011032465519861526291865888128545478530962058792257703950616556136479933021373472378679162332202365371
c= 92084942302809419329882275131365664619817865820237979575321652348851871468885232665120732298048355621943772250718055278615366362227084559410831820721620242260588398786014654743749734106956509345330468686120026908164376320923131751798117799981744551407234489862207435686504148347452579942637697333568788391594
e= 65537
extra_information= 18247071175606431398122118602371784578875472790915317892207044424588309397797319375039984309368393267673885302107217184699052743790470091033147110959310433418937324145720036262540098007724458652548486534453030546582214242131458903058169536052488501597969216020092796160475487905223265691093061136660574497410399108890645909789835984721231354187679269066357591297035974333220513134895660609801438138623213711900681512310067292949714127564635579383633589101296120704659647911638787823818973909534106275908594589830353183557722172234952579827423906720754070119865452363350814918812923981729393142874903734028229195885438296963982680724071663211427931391032589901737528717167662646147224323491202696402122261699504048973334902281462240308032014697804531871922566779026958815207465755155123070196922127199447785648102152027431894178737946151518726929361221425189695069653652163012000609320105988830299015364692678902927254273154427301473090465612473379114039284029813071586214536353994345527805408387636097772645156970939979500155578289301143563369142329343932852167241705090287661795

p, q = z3.Ints('p q')

solver = z3.Solver()

solver.add(extra_information == (p**5)*(q**2)+5*(p**4)*(q**2)+10*(p**3)*(q**2)+5*(p**2)*(q**2)+5*(q**2)*p+(q**2), n == p * q)

if (solver.check() == z3.sat):

    p = solver.model()[p].as_long()
    q = solver.model()[q].as_long()

    phi = (p-1) * (q-1)

    d = inverse(e, phi)

    flag = pow(c, d, n)

    print(long_to_bytes(flag).decode())

```
After running the script we get the decrypted output: `amateursCTF{omg_it's_my_favorite_epic_thing_where_it_looks_like_a_binomial!!}`.
